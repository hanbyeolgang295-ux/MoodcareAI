require("dotenv").config();
const express = require("express");
const cors = require("cors");
const bodyParser = require("body-parser");
const axios = require("axios");

const app = express();
const PORT = 3000;

app.use(cors());
app.use(bodyParser.json());
app.use(express.static("public"));

/* ---------------------------------------------------------
   1) ê°ì • í‚¤ì›Œë“œ ì‚¬ì „
--------------------------------------------------------- */

// ë¶„ë…¸(anger)
const anger = [
  "í™”ë‚˜","í™”ë‚¨","í™”ë‚œ","í™”ë‚˜ë„¤","í™”ë‚˜ì„œ","í™”ë‚˜ê³ ","í™”ë‚œë‹¤","í™”ë‚¬ë‹¤","í™”ê°€ë‚˜","í™”ê°€ë‚œë‹¤",
  "ì§œì¦","ì§œì¦ë‚˜","ì§œì¦ë‚¨","ì§œì¦ë‚œ","ì§œì¦ë‚˜ë„¤","ê°œì§œì¦","ì¡´ë‚˜ì§œì¦","ã…ˆë‚˜ì§œì¦",
  "ë¹¡ì¹˜","ë¹¡ì¹¨","ë¹¡ì³¤","ë¹¡ì¹˜ë„¤","ë¹¡ì³","ê°œë¹¡","ì¡´ë‚˜ë¹¡",
  "ì—´ë°›","ì—´ë°›ì•„","ì—´ë°›ë„¤","ì—´ë°›ìŒ","ì—´ë¶ˆ","ì—´ë¶ˆí„°ì§","ë¶€ê¸€ë¶€ê¸€","ì†í„°ì§",
  "ê¼´ë°›","ê¼´ë³´ê¸°ì‹«","ë³´ê¸°ë„ì‹«",
  "ê¸°ë¶„ë‚˜ì˜","ì–¸ì§¢","ì–¸ì§¢ë„¤","ì¬ìˆ˜ì—†","ì¬ìˆ˜ì—†ë„¤",
  "ì”¨ë°œ","ì‹œë°œ","ã……ã…‚","ã…†ã…‚","ì”¨ë¹¨","ì”¹","ì¢†ê°™","ì¢†ë‚˜","ã…ˆê°™","ã…ˆë‚˜","ê°œê°™","ì—¼ë³‘",
  "í˜„íƒ€ì™€ì„œí™”","ë©˜íƒˆí„°ì§","í­ë°œì§ì „","ë¶„ë…¸","ì—´í­","ëŒê² ë‹¤",
  "ê°œë¹¡ëŒ€ê°€ë¦¬","ë„ë¼ì´ëƒ","ë‡Œì ˆ","ì–´ì´ì—†ì–´ì„œí™”","ìŠ¹ì§ˆë‚˜"
];

// ìŠ¬í””(sadness)
const sadness = [
  "ìš°ìš¸","ìš°ìš¸í•´","ìš°ìš¸í•˜ë‹¤","ìš°ìš¸í•¨",
  "ìŠ¬í”„","ìŠ¬í¼","ìŠ¬í””","ëˆˆë¬¼","ì—‰ì—‰","ìš¸ê³ ì‹¶","ìš¸ì»¥","í‘í‘","í†µê³¡",
  "ì„œëŸ½","ì„œëŸ¬ì›Œ","ë§ˆìŒì•„í”„","ìƒì²˜ë°›","ì†ìƒ","ê°€ìŠ´ì•„í”„",
  "í˜ë“¤","í˜ë“¤ì–´","í˜ë“¤ë‹¤","ë²„ê²","ì§€ì³","ì§€ì³¤",
  "ê³µí—ˆ","í—ˆë¬´","í—ˆíƒˆ","ì“¸ì“¸","ì™¸ë¡­","ì™¸ë¡œì›€","ì™¸ë¡œì›Œ",
  "í˜„íƒ€","í˜„íƒ€ì˜¨","í˜„íƒ€ì™€","ë©˜íƒˆë‚˜ê°”","ë§ˆìƒ","ë§ˆìŒì´ë¬´ë„ˆì§",
  "í”¼ê³¤í•´ì£½ê² ","ê¸°ìš´ì—†","ì‚´ê¸°ì‹«","í¬ê¸°í•˜ê³ ì‹¶","ë¬´ë„ˆì§„ë‹¤",
  "ã… ã… ","ã…œã…œ","ã… ã…œ","ã…œã… "
];

// ë¶ˆì•ˆ(anxiety)
const anxiety = [
  "ë¶ˆì•ˆ","ë¶ˆì•ˆí•´","ë¶ˆì•ˆí•˜ë‹¤","ë¶ˆì•ˆê°",
  "ë‘ë ¤","ë‘ë µ","ë¬´ì„­","ê²ë‚˜","ê²ë‚¨","ê³µí¬",
  "ê¸´ì¥","ì´ˆì¡°",
  "ê±±ì •","ê±±ì •ë¼","ê±±ì •ë˜",
  "ì°ì°","ë¶ˆí¸í•´","ë§ˆìŒì´ì•ˆë†“ì—¬","ì‹¬ë€","ë¶ˆí¸í•˜ë‹¤",
  "ê°€ìŠ´ë–¨ë ¤","ë¶ˆë©´","ì ì´ì•ˆì™€","ì´ˆì¡°í•¨","ë¶ˆì•ˆì •","ì«„ë¦°ë‹¤"
];

// ìŠ¤íŠ¸ë ˆìŠ¤(stress)
const stress = [
  "ìŠ¤íŠ¸ë ˆìŠ¤","ì••ë°•","ì••ë°•ê°","ë¶€ë‹´ë¼","ë¶€ë‹´ê°","ë²„ê±°ì›Œ",
  "ë¨¸ë¦¬ì•„íŒŒ","ê³¨ì¹˜ì•„íŒŒ","ì •ì‹ ì—†","ê³¼ë¶€í•˜","í¬í™”ìƒíƒœ",
  "ë²¼ë½ì¹˜ê¸°","ì§€ì˜¥","ë©˜ë¶•","ë©˜íƒˆë‚˜ê°","ë¨¸ë¦¬í„°ì§ˆê²ƒê°™",
  "ê³¼ì œ","ìˆ™ì œ","ê³¼ì œí­íƒ„","ìˆ™ì œí­íƒ„","ë ˆí¬íŠ¸","ë³´ê³ ì„œ",
  "ì‹œí—˜","ì¤‘ê°„ê³ ì‚¬","ê¸°ë§ê³ ì‚¬","í•™ì—…ìŠ¤íŠ¸ë ˆìŠ¤",
  "ì•Œë°”ìŠ¤íŠ¸ë ˆìŠ¤","ì§ì¥ìŠ¤íŠ¸ë ˆìŠ¤","ì—…ë¬´í­íƒ„","ì¼í­íƒ„"
];

// ë¬´ê¸°ë ¥(lethargy)
const lethargy = [
  "ê·€ì°®","ê·€ì°®ì•„","ê·€ì°®ë‹¤",
  "í•˜ê¸°ì‹«","í•˜ê¸°ì‹«ì–´","í•˜ê¸°ì‹«ë‹¤",
  "ì˜ìš•ì—†","ì˜ìš•ì´ì—†",
  "í˜„íƒ€","ì§€ì¹¨","ë…¸ë‹µ",
  "í”¼ê³¤","í”¼ê³¤í•´","í”¼ê³¤í•˜ë‹¤","ì§€ì³","ê¸°ìš´ì—†","í˜ì´ì•ˆë‚˜",
  "ë™ê¸°ë¶€ì—¬ì•ˆë¨",
  "ì•„ë¬´ê²ƒë„í•˜ê¸°ì‹«","ëˆ•ê³ ì‹¶","ì¹¨ëŒ€ë°–ì€","ì¹¨ëŒ€ë°–","ë‚˜ê°€ê¸°ì‹«",
  "ë©í•¨","ë©í•˜ë‹ˆ","ë©ë•Œë¦¼",
  "ë¬´ê¸°ë ¥","ë¬´ë ¥ê°","í……ë¹ˆ","ê¶Œíƒœ","ê¶Œíƒœê°","ì‹¬ì‹¬","ì‹¬ì‹¬í•´"
];

// ê¸°ì¨(joy)
const joy = [
  "í–‰ë³µ","í–‰ë³µí•´","í–‰ë³µí•˜ë‹¤","í–‰ë³µí•¨",
  "ê¸°ì¨","ê¸°ë»","ê¸°ì˜ë‹¤",
  "ì¢‹ì•„","ì¢‹ë‹¤","ì™„ì „ì¢‹ì•„","ì¡°ìŒ","ì¡°íƒ€",
  "ì„¤ë ˆ","ì„¤ë ˜","ì„¤ë ˆì„","ë‘ê·¼ë‘ê·¼",
  "ì‹ ë‚¬","ì‹ ë‚˜","ì‹ ë‚˜ë„¤","ì¦ê±°","ì¬ë°Œ","ì¬ë¯¸ìˆ","ê¿€ì¼",
  "ì›ƒê²¨","ë¹µí„°ì§","íë§","ê°ì‚¬","ê³ ë§™","ë¿Œë“¯","ëŒ€ë°•","ê°“ìƒ","ì„±ê³µí–ˆë‹¤"
];

// í‰ì˜¨(peace)
const peace = [
  "ê´œì°®","ê´œì°®ì•„","ê´œì°®ë‹¤","ë‚˜ì˜ì§€ì•Š","ë‚˜ì˜ì§€ì•Šë‹¤",
  "ë¬´ë‚œ","í‰ì˜¨","ì°¨ë¶„","í¸ì•ˆ","ì—¬ìœ ë¡­","ì—¬ìœ ë¡œì›€","ì•ˆì •ì ",
  "ì¹¨ì°©","ê´œì°®ì•„ì¡Œì–´","í¸í•˜ë‹¤","í¸ì•ˆí•´","ë§ˆìŒì´í¸","ì§„ì •ë¨","ì¼ìƒì "
];

// ê°•ë„ ì¦ê°€ í‘œí˜„
const intensifiers = ["ê°œ","ì¡´ë‚˜","ã…ˆã„´","ã…ˆë‚˜","ì§„ì§œ","ë„ˆë¬´","ì¡¸ë¼","ì™„ì „","ì—„ì²­"];

/* ---------------------------------------------------------
   2) ê°ì • ë¶„ì„ í•¨ìˆ˜
--------------------------------------------------------- */
function analyzeEmotion(text) {
  if (!text || !text.trim()) return "peace";

  const s = text.replace(/\s+/g, "").toLowerCase();

  const scores = {
    anger: 0,
    sadness: 0,
    anxiety: 0,
    stress: 0,
    lethargy: 0,
    joy: 0,
    peace: 0,
  };

  let intensity = 1;
  intensifiers.forEach(i => {
    if (s.includes(i)) intensity += 0.3;
  });
  if (intensity > 2) intensity = 2;

  function addScore(type, amount) {
    scores[type] += amount * intensity;
  }

  const dict = { anger, sadness, anxiety, stress, lethargy, joy, peace };

  for (const emo in dict) {
    dict[emo].forEach(word => {
      if (s.includes(word)) addScore(emo, 2);
    });
  }

  // ã… /ã…œ í¬í•¨í•˜ë©´ ìŠ¬í”” ë³´ì •
  if (/[ã… ã…œ]/.test(text)) {
    addScore("sadness", 1.5);
  }

  // ê³µë¶€ ê´€ë ¨ ìŠ¤íŠ¸ë ˆìŠ¤
  const studyWords = ["ì‹œí—˜","ê³¼ì œ","ìˆ™ì œ","ë ˆí¬íŠ¸","ë³´ê³ ì„œ","ì¤‘ê°„ê³ ì‚¬","ê¸°ë§ê³ ì‚¬"];
  const hasStudy = studyWords.some(w => s.includes(w));
  const hasHagiSil = s.includes("í•˜ê¸°ì‹«") || s.includes("í•˜ê¸°ì‹«ì–´") || s.includes("í•˜ê¸°ì‹«ë‹¤");
  const hasJjajeung = s.includes("ì§œì¦");

  if (hasStudy) {
    addScore("stress", 1.5);
    if (hasHagiSil || hasJjajeung) {
      addScore("stress", 1.5);
      addScore("lethargy", 1.5);
    }
  }

  // ì‹¬ì‹¬ì€ peace/joy ìª½ìœ¼ë¡œ ì•½í•˜ê²Œ
  if (s.includes("ì‹¬ì‹¬")) {
    addScore("peace", 0.5);
    addScore("joy", 0.5);
  }

  const maxScore = Math.max(...Object.values(scores));
  if (maxScore <= 0) return "peace";

  const priority = ["anger","sadness","anxiety","stress","lethargy","joy","peace"];

  let bestEmotion = "peace";
  let bestScore = -Infinity;

  priority.forEach(emo => {
    if (scores[emo] > bestScore) {
      bestScore = scores[emo];
      bestEmotion = emo;
    }
  });

  return bestEmotion;
}

/* ---------------------------------------------------------
   3) ê°ì •ë³„ ë©”ì‹œì§€/ì¡°ì–¸/ìŠ¤íŠ¸ë ˆìŠ¤ ì ìˆ˜
--------------------------------------------------------- */

const emotionData = {
  joy: {
    msg: "ê¸°ë¶„ ì¢‹ì€ ì—ë„ˆì§€ê°€ ëŠê»´ì ¸ìš”! ì´ ê¸°ë¶„ ì˜¤ë˜ ê°€ì ğŸ˜Š",
    keyword: "happy upbeat kpop"
  },
  anxiety: {
    msg: "ë§ˆìŒì´ ì¢€ ë¶ˆí¸í•˜ê³  ë¶ˆì•ˆí•œ ìƒíƒœ ê°™ì•„ìš”. ë„ˆë¬´ ì˜í•˜ë ¤ê³ ë§Œ í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš” ğŸŒ¿",
    keyword: "calm relaxing piano"
  },
  stress: {
    msg: "ë¨¸ë¦¬ê°€ ë³µì¡í•˜ê³  ë§ˆìŒì´ ë¬´ê±°ì›Œ ë³´ì´ë„¤ìš”. ì ê¹ ìˆ¨ ëŒë¦´ ì‹œê°„, ë‚˜ ìì‹ ì„ ìœ„í•´ ì¨ë„ ë¼ìš” â˜•",
    keyword: "chill lofi beats"
  },
  sadness: {
    msg: "ë§ì´ í˜ë“¤ê³  ì§€ì¹œ ë§ˆìŒì´ ëŠê»´ì ¸ìš”. ì–µì§€ë¡œ ê´œì°®ì€ ì²™ ì•ˆ í•´ë„ ë¼ìš”, ê·¸ëƒ¥ ì´ ë…¸ë˜ ë“¤ìœ¼ë©´ì„œ ì ê¹ ê¸°ëŒ€ë„ ë¼ìš” ğŸ˜¢",
    keyword: "emotional sad ballad"
  },
  anger: {
    msg: "ì§„ì§œ ë§ì´ ë‹µë‹µí•˜ê³  ì§œì¦ë‚˜ëŠ” ìƒí™© ê°™ì•„ìš”. ì´ëŸ´ ë• í…ì…˜ ë†’ì€ ìŒì•…ìœ¼ë¡œ í•œ ë²ˆ í™• í„¸ì–´ë²„ë ¤ìš” ğŸ”¥",
    keyword: "energetic rock"
  },
  lethargy: {
    msg: "ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ê³  ê¸°ìš´ì´ ì­‰ ë¹ ì§„ ìƒíƒœë„¤ìš”. ì˜¤ëŠ˜ì€ â€˜ë‚˜ë¥¼ ìœ„í•œ íœ´ì‹ ëª¨ë“œâ€™ì—¬ë„ ê´œì°®ì•„ìš” ğŸ’¤",
    keyword: "acoustic chill"
  },
  peace: {
    msg: "í° íŒŒë„ëŠ” ì—†ì§€ë§Œ, ì¡°ìš©í•œ ë¬¼ê²° ê°™ì€ ìƒíƒœë„¤ìš”. ì´ í‰ì˜¨í•¨ë„ ê½¤ ì†Œì¤‘í•œ ìˆœê°„ì´ì—ìš” â˜ï¸",
    keyword: "peaceful ambient"
  },
};

function generateAdvice(emotion) {
  const adviceList = {
    joy: [
      "ì´ í–‰ë³µí•œ ê¸°ë¶„ì„ ì¶©ë¶„íˆ ëŠë¼ê³ , ë‚˜ë¥¼ ì¹­ì°¬í•´ì£¼ëŠ” í•˜ë£¨ê°€ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ì–´ìš” ğŸŒˆ",
      "ì˜¤ëŠ˜ì˜ ì¦ê±°ìš´ ìˆœê°„ë“¤ì„ ì‚¬ì§„ì´ë‚˜ ê¸€ë¡œ ë‚¨ê²¨ë³´ëŠ” ê±´ ì–´ë•Œìš”? ë‚˜ì¤‘ì— í° í˜ì´ ë  ê±°ì˜ˆìš” ğŸ“¸"
    ],
    sadness: [
      "ì§€ê¸ˆ ëŠë¼ëŠ” ìŠ¬í””ì€ ì ˆëŒ€ ê°€ë²¼ìš´ ê°ì •ì´ ì•„ë‹ˆì—ìš”. ìš¸ê³  ì‹¶ìœ¼ë©´ ë§ˆìŒê» ìš¸ì–´ë„ ê´œì°®ì•„ìš” ğŸ’™",
      "í˜ë“  ë§ˆìŒì„ í˜¼ì ë‹¤ ì•ˆê³  ìˆìœ¼ë ¤ê³  í•˜ì§€ ì•Šì•„ë„ ë¼ìš”. ë¯¿ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì—ê²Œ ì¡°ê¸ˆ í„¸ì–´ë†”ë„ ì¢‹ì•„ìš”."
    ],
    anger: [
      "í™”ê°€ ë‚˜ëŠ” ê±´ ë„ˆë¬´ ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì´ì—ìš”. ë‹¤ë§Œ, ê·¸ ê°ì •ì„ ë‹¤ì¹˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ í’€ì–´ë‚´ëŠ” ê²Œ ì¤‘ìš”í•´ìš” ğŸ”¥",
      "ì ê¹ ìë¦¬ë¥¼ ë²—ì–´ë‚˜ì„œ ì‚°ì±…ì„ í•˜ê±°ë‚˜, ìŒì•…ì„ í¬ê²Œ í‹€ê³  ë”°ë¼ ë¶€ë¥´ëŠ” ê²ƒë„ ì¢‹ì„ ê±°ì˜ˆìš”."
    ],
    anxiety: [
      "ì•ìœ¼ë¡œ ì¼ì–´ë‚  ì¼ì„ ì „ë¶€ í†µì œí•  ìˆ˜ëŠ” ì—†ì§€ë§Œ, ì§€ê¸ˆ ì´ ìˆœê°„ì˜ ë‚˜ë¥¼ ëŒë³´ëŠ” ê±´ ê°€ëŠ¥í•´ìš” ğŸŒ¿",
      "í•œ ë²ˆì— ëª¨ë“  ê±¸ í•´ê²°í•˜ë ¤ê³  í•˜ì§€ ë§ê³ , ì˜¤ëŠ˜ í•  ìˆ˜ ìˆëŠ” ì¼ í•œ ê°€ì§€ë§Œ ì •í•´ë³´ëŠ” ê±´ ì–´ë•Œìš”?"
    ],
    stress: [
      "ì§€ê¸ˆê¹Œì§€ ì •ë§ ì—´ì‹¬íˆ ë²„í…¨ì˜¨ ë‚˜ ìì‹ ì—ê²Œ ì‘ì€ ì„ ë¬¼ì„ ì£¼ëŠ” í•˜ë£¨ê°€ ë˜ì—ˆìœ¼ë©´ ì¢‹ê² ì–´ìš” â˜•",
      "í•  ì¼ ì‚¬ì´ì— 5ë¶„ì”©ì´ë¼ë„ íœ´ì‹ íƒ€ì´ë¨¸ë¥¼ ë„£ì–´ë³´ë©´, ë¨¸ë¦¬ê°€ ì¡°ê¸ˆì€ ëœ ë³µì¡í•´ì§ˆ ê±°ì˜ˆìš”."
    ],
    lethargy: [
      "ì•„ë¬´ê²ƒë„ í•˜ê¸° ì‹«ì€ ë‚ ë„ ìˆì–´ìš”. ê·¸ëŸ° ë‚ ì—” 'ê·¸ëƒ¥ ìˆ¨ ì‰¬ê³  ìˆëŠ” ë‚˜'ë§Œìœ¼ë¡œë„ ì¶©ë¶„í•´ìš” ğŸŒ™",
      "ì—ë„ˆì§€ê°€ ì—†ì„ ë•, í•´ì•¼ í•  ì¼ì„ ì¤„ì´ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ì„ íƒì´ì—ìš”. ì˜¤ëŠ˜ì€ ì¡°ê¸ˆ ê°€ë³ê²Œ ê°€ë³¼ê¹Œìš”?"
    ],
    peace: [
      "ì´ í‰ì˜¨í•œ ìˆœê°„ì„ ì˜ ì €ì¥í•´ë‘ë©´, í˜ë“¤ ë•Œ í° í˜ì´ ë  ê±°ì˜ˆìš” ğŸ€",
      "ë§ˆìŒì´ í¸ì•ˆí•  ë•Œ ì¢‹ì•„í•˜ëŠ” ì‚¬ëŒë“¤ê³¼ì˜ ëŒ€í™”ë‚˜ ê°€ë²¼ìš´ ì‚°ì±…ì„ ì¦ê²¨ë³´ëŠ” ê²ƒë„ ì¢‹ê² ì–´ìš”."
    ]
  };

  const list = adviceList[emotion] || adviceList["peace"];
  return list[Math.floor(Math.random() * list.length)];
}

function calculateStress(emotion) {
  const score = {
    joy: 15,
    peace: 25,
    lethargy: 45,
    sadness: 70,
    anxiety: 80,
    stress: 85,
    anger: 90
  };
  return score[emotion] || 50;
}

/* ---------------------------------------------------------
   4) Spotify í† í° & ê²€ìƒ‰
--------------------------------------------------------- */

async function getSpotifyToken() {
  try {
    const res = await axios.post(
      "https://accounts.spotify.com/api/token",
      new URLSearchParams({ grant_type: "client_credentials" }),
      {
        headers: {
          Authorization:
            "Basic " +
            Buffer.from(
              process.env.SPOTIFY_CLIENT_ID +
              ":" +
              process.env.SPOTIFY_CLIENT_SECRET
            ).toString("base64"),
          "Content-Type": "application/x-www-form-urlencoded",
        },
      }
    );
    return res.data.access_token;
  } catch (e) {
    console.log("Spotify í† í° ì˜¤ë¥˜:", e.response?.data || e.message);
    return null;
  }
}

/* ---------------------------------------------------------
   5) /analyze ì—”ë“œí¬ì¸íŠ¸
--------------------------------------------------------- */

app.post("/analyze", async (req, res) => {
  const { text } = req.body;
  console.log(`ğŸ“¨ ì‚¬ìš©ì ì…ë ¥: "${text}"`);

  const emotion = analyzeEmotion(text);
  const stressScore = calculateStress(emotion);
  const advice = generateAdvice(emotion);
  const data = emotionData[emotion] || emotionData["peace"];

  const token = await getSpotifyToken();
  let music = [];

  if (token) {
    try {
      const offset = Math.floor(Math.random() * 80);

      const search = await axios.get("https://api.spotify.com/v1/search", {
        headers: { Authorization: `Bearer ${token}` },
        params: {
          q: data.keyword,
          type: "track",
          limit: 20,
          offset,
        },
      });

      const items = search.data.tracks.items;

      music = items
        .sort(() => Math.random() - 0.5)
        .slice(0, 5)
        .map((t) => ({
          title: `${t.artists[0].name} - ${t.name}`,
          url: t.external_urls.spotify,
          image: t.album.images?.[0]?.url || "default-cover.jpg"
        }));
    } catch (e) {
      console.log("Spotify ê²€ìƒ‰ ì˜¤ë¥˜:", e.response?.data || e.message);
      music = [
        {
          title: "YouTubeì—ì„œ ë¹„ìŠ·í•œ ë¶„ìœ„ê¸° ìŒì•… ì°¾ì•„ë³´ê¸°",
          url:
            "https://www.youtube.com/results?search_query=" +
            encodeURIComponent(data.keyword),
          image: "default-cover.jpg"
        },
      ];
    }
  }

  res.json({
    emotion,
    message: data.msg,
    advice,
    stress: stressScore,
    music,
  });
});

/* ---------------------------------------------------------
   6) ì„œë²„ ì‹¤í–‰
--------------------------------------------------------- */

app.listen(PORT, () => {
  console.log(`ğŸš€ í‚¤ì›Œë“œ ê¸°ë°˜ ê°ì • ë¶„ì„ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${PORT}`);
});
